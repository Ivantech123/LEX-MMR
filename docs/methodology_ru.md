# LexMMR™: Методология рейтинга

> **Обратите внимание:** Настоящий документ описывает финальную, целевую методологию системы рейтинга **LexMMR™**. Я, как автор проекта, стремлюсь к максимальной прозрачности и объективности, поэтому публикую эту методологию в первую очередь. 
> 
> Сам программный комплекс и онлайн-сервис находятся в стадии активной итеративной разработки. Некоторые компоненты, описанные здесь, внедряются в данный момент. Я непрерывно работаю над реализацией всех аспектов системы, чтобы обеспечить её надёжность и точность. 
> 
> *С уважением, Иван Андреев.*



> TL;DR: открытые данные + прозрачная формула + минимизация человеческого фактора = объективный рейтинг.

---

## 1. Источники данных

| Блок | Откуда берём | Как получаем |
|------|--------------|--------------|
| Судебные дела | ГАС «Правосудие», sudrf.ru, kartoteka.ru | Headless-скрапинг + RuCaptcha, регулярное обновление cron-парсером |
| Отзывы клиентов | 2GIS, Flamp | REST/HTML-парсер, удаляем накрутку через z-score > 2σ |
| Дисциплинарные меры | Реестры ФПА РФ, сайты палат | HTML-парсер (BeautifulSoup) |
| Медиа-упоминания | NewsAPI.org / Perplexity Web-search | AI-обратка: считаем уникальные публикации за 12 мес. |
| Peer review | Анонимная форма Google / Typeform | ручная модерация + удостоверение email |

Все данные сохраняются в SQLite → можно реплицировать без доступа к закрытым базам.

## 2. Роль ИИ-моделей

1. **Perplexity API** – задаём prompt _«Give me JSON snapshot for …»_, получаем структурированный результат (опыт, громкие дела, медиа-ссылки).
2. **LLM-postprocessing** – ChatGPT 3.5-turbo валидирует outliers, категоризирует типы дел.
3. **Zero-shot классификатор** – модель `RuSentiment` определяет тональность отзывов.

ИИ-модели не «придумывают» рейтинг, а только преобразуют открытые данные → повышают скорость.

## 3. Формула рейтинга (v1.1)

```
final = 0.55 * glicko_norm
       + 0.15 * bayes_win
       + 0.10 * reviews_norm
       + 0.10 * experience_norm
       + 0.05 * media_norm
       + 0.05 * peer_nps_norm
```

### 3.1 Glicko-2
* `rating`, `rd`, `volatility`.  Initial: 1500 ±350.
* Оппонент = сложность дела `complexity ∈ [0.8, 1.4]`.
* Δ вычисляется после каждого решения.

`glicko_norm = clamp((rating-800)/(2400-800), 0,1)`

### 3.2 Bayes Win-rate
```
(wins + 1) / (cases + 2)
```
Сглаживает адвокатов с <5 кейсов.

### 3.3 Reviews
```
(avg_score*n + 3.5*m) / (n+m)  ;  m = 10
```

### 3.4 Experience
```
ln(1 + years)/ln(31)  ∈ [0,1]
```

### 3.5 Media & Peer-NPS
Счётчик уникальных новостей / Net-Promoter-Score коллег, нормируются к 0-1.

## 4. Независимость и открытость

* **Open-source**: весь код MIT-лицензия.  Любой может пересобрать Docker-образ и пересчитать рейтинг.
* **Open data only**: ни одного платного или закрытого источника.
* **Конфиг-весов** расположен в `rating.py::WEIGHTS` – прозрачно.
* **Автоматизация**: ночной cron-pipeline, без ручного «голосования».
* **Верификация**: каждый адвокат может скачать JSON-снимок своего профиля.
* **GDPR / 152-ФЗ**: храним только публично-доступную информацию.

## 5. Расширения (roadmap)

1. Распределённая очередь задач (Celery + Redis).
2. Миграция на PostgreSQL + Timescale для истории рейтинга.
3. UI: доверительный интервал ±RD и график изменения.
4. ML-модель ранжирования win-prob на базе 100k арбитражных дел.


## 6. Расширенная формула рейтинга v2.0 (draft)

> Ниже приведён полный список метрик, весов и формул, к которым мы будем постепенно мигрировать. Раздел предназначен для аналитиков и разработчиков.

### 6.1 Декомпозиция TOTAL

| № | Блок                     | Вес | Состав блока | Формула нормализации |
|---|--------------------------|-----|--------------|----------------------|
| 1 | **Glicko-2**             | **0.45** | rating_norm 0.35, RD_penalty 0.10 | `rating_norm = clamp(100*(r-800)/(2400-800))`, `RD_penalty = max(0,(rd-50)/300)*100` |
| 2 | **Bayes Win-Rate**       | 0.10 | (wins+1)/(cases+2) | напрямую → 0-100 |
| 3 | **Disciplinary**         | 0.08 | Σ warning/ suspension | `Δ·e^(−t/τ)` ; см. 6.4 |
| 4 | **Client Reviews**       | 0.08 | bayes_avg, sentiment_adj | см. 6.5 |
| 5 | **Experience**           | 0.05 | years_norm, court_level_bonus | `ln(1+years)/ln(31)` |
| 6 | **Media Presence**       | 0.05 | uniq_news_12m, tone | лог-норм. |
| 7 | **Peer NPS**            | 0.05 | promoters, detractors | `50+NPS*50` |
| 8 | **Project Size**         | 0.04 | log(sum_dispute_value) | лог-норм. |
| 9 | **Industry Diversity**   | 0.03 | entropy(practice_area) | `H/Hmax` |
|10 | **Education & Certs**    | 0.03 | degree_score, CPD hrs | линейно |
|11 | **Pro-bono & CSR**       | 0.02 | hours_norm | линейно |
|12 | **Awards/Rankings**      | 0.02 | weighted_count | линейно |

`TOTAL = Σ Wi·Fi`, результат 0-100.

### 6.2 Glicko-2 параметры
```
init_rating = 1500, rd = 350, vol = 0.06
τ = 0.5  # volatility constraint
daily update after each decision
```

### 6.3 Trust Index
```
TI = 1 - RD/350  # 0..1
```
Используем как индикатор надёжности: Green >0.7, Yellow 0.4-0.7, Red <0.4.

### 6.4 Disciplinary penalty
| Severity | Δ балла | Период затухания |
|----------|---------|------------------|
| Warning  | −20     | e^(−t/730)       |
| Suspension | −60   | e^(−t/1095)      |

### 6.5 Отзывы клиентов
```
bayes = (avg*n + 3.5*m)/(n+m)  # m = 10 (приор)
sentiment_adj = (pos - neg)*10  # RuSentiment
Fi = clamp(score(bayes)+sentiment_adj, 0,100)
```

### 6.6 Шедулы обновлений
- **daily**: Glicko-2, дисциплинарка, новости.
- **weekly**: перерасчёт Reviews/Sentiment, TOTAL.
- **monthly**: snapshot history, калибровка min/max.

### 6.7 Прозрачность и open data
1. Каждая метрика — ссылка на сырые данные (JSON / CSV).
2. `weights.yml` хранится в репозитории; PR-дискуссии → изменение версии формулы (SemVer).
3. docker-compose делает сборку дет-pipeline без закрытых ключей.

---

## 7. LexMMR™: Технический разбор методологии (Whitepaper)

Я представляю **LexMMR™** — открытый и воспроизводимый индекс для оценки деятельности юристов. Ниже приведён детальный технический разбор каждого компонента.

--- 

### 7.1. Ядро рейтинга: Судебная эффективность

#### **Система рейтинга Glicko-2**
Каждый юрист в системе характеризуется тремя параметрами: **рейтинг (μ)**, **отклонение рейтинга (RD, φ)** и **волатильность рейтинга (σ)**. После каждого дела эти параметры обновляются. Ключевое преимущество — учёт неопределённости: RD увеличивается со временем, если юрист не участвует в делах, и уменьшается после каждого нового дела. Это позволяет системе честно говорить: «Я менее уверен в рейтинге этого специалиста, так как у него давно не было практики».

*Источник: [Glickman, M. E. (2001). Example of the Glicko-2 system.](http://www.glicko.net/glicko/glicko2.pdf)*

#### **ML-классификатор сложности дел (LightGBM)**
Для оценки сложности дел я использую модель **LightGBM**. Она выбрана за высокую производительность и способность эффективно работать с категориальными признаками. Модель обучается на таких параметрах, как: `сумма иска`, `количество сторон`, `инстанция` (первая, апелляция, кассация), `тип спора` и `объём материалов дела`. Победа над юристом с высоким рейтингом в деле с высоким коэффициентом сложности даёт максимальный прирост.

*Источник: [Ke, G., et al. (2017). LightGBM: A Highly Efficient Gradient Boosting Decision Tree.](https://proceedings.neurips.cc/paper/2017/file/6449f44a102fde848669bdd9eb6b76fa-Paper.pdf)*

### 7.2. Репутационные факторы и этика

#### **Дисциплинарные взыскания (с экспоненциальным затуханием)**
Штраф за взыскание не является вечным. Его влияние уменьшается по формуле экспоненциального затухания: `ТекущийШтраф = ИсходныйШтраф * e^(-λt)`, где `λ` — константа распада (подобрана так, чтобы штраф уменьшался вдвое за 18 месяцев), а `t` — время с момента взыскания. Это позволяет специалистам исправлять ошибки прошлого.

#### **Отзывы клиентов (Байесовское сглаживание)**
Для защиты от накруток используется формула Байесовского среднего: `Рейтинг = (C * m + ΣОценок) / (C + N)`, где `C` — «доверие» к априорной оценке (например, 5), `m` — средняя оценка по рынку (например, 3.8), `ΣОценок` — сумма всех оценок юриста, `N` — их количество. 
**Пример:** Юрист с двумя отзывами по 5.0 звёзд будет иметь рейтинг `(5*3.8 + 10) / (5+2) ≈ 4.14`, а не 5.0, что является более честной оценкой.

*Источник: [Miller, E. (2012). Bayesian Average Ratings.](https://www.evanmiller.org/bayesian-average-ratings.html)*

#### **Оценка коллегами (Peer-NPS)**
Анонимные опросы рассчитываются по формуле `NPS = %Промоутеров - %Детракторов`. Для защиты от сговоров используется анализ графов для выявления «колец рекомендаций» (когда группа юристов рекомендует только друг друга).

*Источник: [Reichheld, F. F. (2003). The One Number You Need to Grow. Harvard Business Review.](https://hbr.org/2003/12/the-one-number-you-need-to-grow)*

### 7.3. Принцип полной прозрачности

#### **Публичный API для аудита**
Доверие невозможно без прозрачности. Поэтому я предоставляю публичный **GraphQL API** со следующими эндпоинтами для независимого аудита:
- `lawyer(id: ID!)`: получение полного профиля юриста, включая историю рейтинга и деперсонализированный список дел.
- `cases(lawyerId: ID!)`: получение списка дел с их коэффициентами сложности и исходами.
- `methodology`: получение текущих весовых коэффициентов всех компонентов рейтинга.

Таким образом, я создаю не «чёрный ящик», а открытую и проверяемую экосистему.


_Последнее обновление: 04-08-2025._
